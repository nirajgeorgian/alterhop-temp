{"version":3,"sources":["../src/dbconn.js"],"names":["require","config","mongoUrl","process","env","MONGO_URL","MONGO_DB","mongoose","set","mongooseConnect","connect","autoReconnect","useNewUrlParser","connectTimeoutMS","mongodb","connection","mongoConnect","Promise","resolve","reject","once","stdout","write","on","error","stderr","Error","dbDisconnect","disconnect","done","redisClient","redis","createClient","REDIS_SERVER_PORT","redisConnect","err","message","exit","resolveAll"],"mappings":";;;;;;;AACA;;;;AACA;;;;;;;;AAFAA,QAAQ,QAAR,EAAkBC,MAAlB;;;AAIA;;;;AAIA,IAAMC,WAAcC,QAAQC,GAAR,CAAYC,SAA1B,SAAuCF,QAAQC,GAAR,CAAYE,QAAzD;AACAC,mBAASC,GAAT,CAAa,gBAAb,EAA+B,KAA/B;AACA,IAAMC,kBAAkBF,mBAASG,OAAT,CAAiBR,QAAjB,EAA2B,EAAES,eAAe,IAAjB,EAAuBC,iBAAiB,IAAxC,EAA8CC,kBAAkB,IAAhE,EAA3B,CAAxB;AACA,IAAMC,UAAUP,mBAASQ,UAAzB;AACA,IAAMC,eAAe,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrDL,SAAQM,IAAR,CAAa,MAAb,EAAqB,YAAM;AAC1BjB,UAAQkB,MAAR,CAAeC,KAAf,gCAAwCpB,QAAxC;AACAgB,UAAQJ,OAAR;AACA,EAHD;AAIAA,SAAQS,EAAR,CAAW,OAAX,EAAoB,UAACC,KAAD,EAAW;AAC9BrB,UAAQsB,MAAR,CAAeH,KAAf,CAAqB,6CAArB;AACAnB,UAAQsB,MAAR,CAAeH,KAAf,CAAwBE,KAAxB;AACAL,SAAO,IAAIO,KAAJ,CAAU,6BAAV,CAAP;AACA,EAJD;AAKA,CAVoB,CAArB;;AAYA;AACA,IAAMC,eAAe,SAAfA,YAAe,OAAQ;AAC5BpB,oBAASqB,UAAT,CAAoBC,IAApB;AACA,CAFD;;AAIA;;;;AAIA,IAAMC,cAAcC,gBAAMC,YAAN,MAAsB7B,QAAQC,GAAR,CAAY6B,iBAAlC,cAApB;AACA,IAAMC,eAAe,IAAIjB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrDW,aAAYP,EAAZ,CAAe,OAAf,EAAwB,eAAO;AAC9B;AACApB,UAAQsB,MAAR,CAAeH,KAAf,oBAAsCa,IAAIC,OAAJ,EAAtC;AACAjB,SAAOgB,IAAIC,OAAJ,EAAP;AACAjC,UAAQkC,IAAR;AACA,EALD;AAMAP,aAAYP,EAAZ,CAAe,SAAf,EAA0B,YAAM;AAC/BpB,UAAQkB,MAAR,CAAeC,KAAf;AACAJ,UAAQY,WAAR;AACA,EAHD;AAIA,CAXoB,CAArB;;AAaA,IAAMQ;AAAA,oEAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACZtB,YADY;;AAAA;AAAA;AAAA,aAEZkB,YAFY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAb;;AAAA;AAAA;AAAA;AAAA,GAAN;;QAMCI,U,GAAAA,U;QACAJ,Y,GAAAA,Y;QACAP,Y,GAAAA,Y","file":"dbconn.js","sourcesContent":["require('dotenv').config()\nimport mongoose from 'mongoose'\nimport redis from 'redis'\n\n/*\n\t@mongodb connection\n\tDatabase connection for nosql database\n*/\nconst mongoUrl = `${process.env.MONGO_URL}/${process.env.MONGO_DB}`\nmongoose.set('bufferCommands', false)\nconst mongooseConnect = mongoose.connect(mongoUrl, { autoReconnect: true, useNewUrlParser: true, connectTimeoutMS: 1000 })\nconst mongodb = mongoose.connection\nconst mongoConnect = new Promise((resolve, reject) => {\n\tmongodb.once('open', () => {\n\t\tprocess.stdout.write(`ðŸš€ Connected to ${mongoUrl} nosql mongo database \\n`)\n\t\tresolve(mongodb)\n\t})\n\tmongodb.on('error', (error) => {\n\t\tprocess.stderr.write('Error occured during database connection \\n')\n\t\tprocess.stderr.write(`${error} \\n`)\n\t\treject(new Error(\"Error connection to mongodb\"))\n\t})\n})\n\n/* mongoose disconnect connection used for testing */\nconst dbDisconnect = done => {\n\tmongoose.disconnect(done)\n}\n\n/*\n\t@redis connection\n\tcreate a redis client and connection is established\n*/\nconst redisClient = redis.createClient(`${process.env.REDIS_SERVER_PORT}`, `localhost`)\nconst redisConnect = new Promise((resolve, reject) => {\n\tredisClient.on('error', err => {\n\t\t// redis error\n\t\tprocess.stderr.write(`Error occured ${err.message()}`)\n\t\treject(err.message())\n\t\tprocess.exit()\n\t})\n\tredisClient.on('connect', () => {\n\t\tprocess.stdout.write(`ðŸš€ Connected to redis redis:6379`)\n\t\tresolve(redisClient)\n\t})\n})\n\nconst resolveAll = async () => {\n\tawait mongoConnect\n\tawait redisConnect\n}\n\nexport {\n\tresolveAll,\n\tredisConnect,\n\tdbDisconnect\n}\n"]}